<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gear Shop - Vote Rewards</title>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; padding: 50px; }
        .item-card { background: #2a2a2a; border: 1px solid #f3ad1e; padding: 15px; width: 300px; border-radius: 10px; text-align: center; }
        button { background: #f3ad1e; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; border-radius: 5px; }
        button:hover { background: #ffc145; }
        select { margin: 10px 0; padding: 5px; width: 80%; }
    </style>
</head>
<body>

    <div class="item-card">
        <h3>Super Sword</h3>
        <p>Cost: 50 Voting Points</p>

        <label>Deliver to:</label><br>
        <select id="vote_char_select">
            <option value="">-- Loading --</option>
        </select><br>

        <button onclick="buyItem(22691, 50)">Buy with Points</button>
    </div>

<script>
    const accountId = 1; // Set to logged-in user's ID

    // Populate dropdown
    fetch(`http://127.0.0.1:5000/get-characters/${accountId}`)
        .then(res => res.json())
        .then(data => {
            const select = document.getElementById('vote_char_select');
            select.innerHTML = '<option value="">-- Select --</option>';
            data.forEach(name => {
                select.innerHTML += `<option value="${name}">${name}</option>`;
            });
        });

    function buyItem(itemId, cost) {
        const charName = document.getElementById('vote_char_select').value;
        if(!charName) return alert("Please select a character first!");

        fetch('http://127.0.0.1:5000/buy-with-points', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                account_id: accountId,
                character_name: charName,
                item_id: itemId,
                cost: cost
            })
        })
        .then(res => res.json())
        .then(data => {
            if(data.message) alert("Success! " + data.message);
            else alert("Error: " + data.error);
        })
        .catch(err => alert("Bridge Offline. Is armory.py running?"));
    }
</script>

</body>
</html>
